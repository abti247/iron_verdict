<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Verdict — Powerlifting Judging</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <script
        defer
        src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"
        integrity="sha384-l8f0VcPi/M1iHPv8egOnY/15TDwqgbOR1anMIJWvU6nLRgZVLTLSaNqi/TOoT5Fh"
        crossorigin="anonymous">
    </script>
</head>
<body x-data="ironVerdictApp()" :class="{ 'display-mode': role === 'display' && screen === 'display' }">

    <!-- Landing Screen -->
    <div class="landing-wrap" x-show="screen === 'landing'">
        <div class="landing-panel cut-corner">
            <div class="brand-iron chrome-text">Iron Verdict</div>
            <div class="brand-verdict-sub">Powerlifting Judging</div>

            <div class="form-stack">
                <input class="chrome-input" placeholder="Session name (e.g. Platform A)"
                       x-model="newSessionName" @keyup.enter="createSession()">
                <button class="btn-blood btn-blood-primary cut-corner-sm"
                        @click="createSession()" :disabled="!newSessionName.trim()">
                    Create New Session
                </button>

                <div class="slash-divider">or</div>

                <input class="chrome-input" placeholder="Enter 8-character session code"
                       x-model="joinCode" @keyup.enter="joinExistingSession()">
                <button class="btn-blood btn-blood-secondary cut-corner-sm"
                        @click="joinExistingSession()">
                    Join Session
                </button>
            </div>

            <div style="margin-top: 16px;">
                <button class="btn-blood btn-blood-ghost" @click="startDemo()">
                    Start Demo
                </button>
            </div>
        </div>
    </div>

    <!-- Role Selection Screen -->
    <div class="role-wrap" x-show="screen === 'role-select'">
        <div class="role-panel cut-corner">
            <div class="role-heading chrome-text">Select Role</div>
            <div class="session-tag">
                Session: <span class="code" @click="returnToLanding()" x-text="sessionCode"></span>
            </div>

            <div class="role-grid">
                <button class="role-btn cut-corner-sm" @click="joinSession('left_judge')">
                    Left<br>Judge
                </button>
                <button class="role-btn cut-corner-sm" @click="joinSession('center_judge')">
                    Center<br>Judge<span class="sub">(Head)</span>
                </button>
                <button class="role-btn cut-corner-sm" @click="joinSession('right_judge')">
                    Right<br>Judge
                </button>
                <button class="role-btn role-display-btn cut-corner-sm" @click="joinSession('display')">
                    Display Screen
                </button>
            </div>
        </div>
    </div>

    <!-- Judge Screen -->
    <div class="judge-wrap" x-show="screen === 'judge'">
        <div class="judge-bar">
            <div class="judge-role-label" x-text="getRoleDisplayName()"></div>
            <div class="judge-timer" :class="timerExpired && 'expired'" x-text="timerDisplay"></div>
            <div class="judge-code">
                <span class="code-link" @click="returnToRoleSelection()" x-text="sessionCode"></span>
            </div>
        </div>

        <div class="vote-grid" x-show="!showingReasonStep" :style="voteLocked ? 'opacity:0.35;pointer-events:none' : ''">
            <button class="vote-btn vote-white cut-corner-sm"
                    :class="selectedVote === 'white' && 'selected'"
                    @click="selectVote('white')" :disabled="voteLocked">
                WHITE
            </button>
            <button class="vote-btn vote-red cut-corner-sm"
                    :class="selectedVote === 'red' && 'selected'"
                    @click="selectVote('red')" :disabled="voteLocked">
                RED
            </button>
            <button class="vote-btn vote-blue cut-corner-sm"
                    :class="selectedVote === 'blue' && 'selected'"
                    @click="selectVote('blue')" :disabled="voteLocked">
                BLUE
            </button>
            <button class="vote-btn vote-yellow cut-corner-sm"
                    :class="selectedVote === 'yellow' && 'selected'"
                    @click="selectVote('yellow')" :disabled="voteLocked">
                YELLOW
            </button>
        </div>

        <div class="reason-step" x-show="showingReasonStep && !voteLocked">
            <div class="reason-step-header">
                <button class="back-btn" @click="goBackToColorStep()">&#8592; back</button>
                <span class="reason-step-color" :class="selectedVote" x-text="selectedVote?.toUpperCase()"></span>
            </div>
            <div class="reason-list">
                <template x-for="reason in getJudgeReasons()" :key="reason">
                    <div class="reason-item"
                         :class="{ selected: selectedReason === reason }"
                         @click="selectReason(reason)"
                         x-text="reason">
                    </div>
                </template>
            </div>
        </div>

        <button class="lock-btn cut-corner-sm"
                x-show="canLockIn() && !voteLocked"
                @click="lockVote()">
            LOCK IN
        </button>

        <div class="locked-status" x-show="voteLocked">
            &#10003; Vote Locked &#8212; <span x-text="selectedVote?.toUpperCase()"></span>
        </div>

        <div class="head-section" x-show="isHead">
            <div class="head-title">Head Judge Controls</div>
            <div class="head-grid">
                <button class="btn-blood btn-blood-primary cut-corner-sm"
                        @click="startTimer()">Start Timer</button>
                <button class="btn-blood btn-blood-secondary cut-corner-sm"
                        @click="resetTimer()">Reset Timer</button>
                <button class="btn-blood btn-blood-primary cut-corner-sm"
                        @click="nextLift()" :disabled="!resultsShown">Next Lift</button>
                <button class="btn-blood btn-blood-ghost"
                        @click="confirmEndSession()">End Session</button>
            </div>
            <div class="settings-bar">
                <label>
                    <input type="checkbox" x-model="showExplanations" @change="saveSettings()">
                    Show rule explanations
                </label>
                <label>
                    <input type="checkbox" x-model="requireReasons" @change="saveSettings()">
                    Require reasons
                </label>
                <select x-model="liftType" @change="saveSettings()">
                    <option value="squat">Squat</option>
                    <option value="bench">Bench Press</option>
                    <option value="deadlift">Deadlift</option>
                </select>
            </div>
        </div>

        <!-- Judge Results Panel -->
        <div class="head-section" x-show="resultsShown">
            <div class="head-title">Results</div>
            <div class="judge-results-orbs">
                <div class="judge-result-orb-wrap">
                    <div class="display-orb display-orb--sm" :class="judgeResultVotes.left"></div>
                    <div class="display-orb-reason"
                         x-show="judgeResultReasons.left"
                         x-text="judgeResultReasons.left"></div>
                </div>
                <div class="judge-result-orb-wrap">
                    <div class="display-orb display-orb--sm" :class="judgeResultVotes.center"></div>
                    <div class="display-orb-reason"
                         x-show="judgeResultReasons.center"
                         x-text="judgeResultReasons.center"></div>
                </div>
                <div class="judge-result-orb-wrap">
                    <div class="display-orb display-orb--sm" :class="judgeResultVotes.right"></div>
                    <div class="display-orb-reason"
                         x-show="judgeResultReasons.right"
                         x-text="judgeResultReasons.right"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Display Screen: shows sessionName only — sessionCode intentionally omitted (C3) -->
    <div class="display-full" x-show="screen === 'display'">
        <div class="display-tag">
            <span x-show="!isDemo" x-text="sessionName"></span>
            <span x-show="isDemo">DEMO</span>
        </div>

        <div class="display-timer-big" :class="timerExpired && 'expired'" x-text="timerDisplay"></div>

        <!-- Vote orbs with reasons -->
        <div class="display-lights" x-show="displayPhase === 'votes' || displayPhase === 'idle'">
            <div class="display-orb-wrap">
                <div class="display-orb" :class="displayVotes.left"></div>
                <div class="display-orb-reason"
                     x-show="displayShowExplanations && displayVotes.left && displayVotes.left !== 'white' && displayReasons.left"
                     x-text="displayReasons.left"></div>
            </div>
            <div class="display-orb-wrap">
                <div class="display-orb" :class="displayVotes.center"></div>
                <div class="display-orb-reason"
                     x-show="displayShowExplanations && displayVotes.center && displayVotes.center !== 'white' && displayReasons.center"
                     x-text="displayReasons.center"></div>
            </div>
            <div class="display-orb-wrap">
                <div class="display-orb" :class="displayVotes.right"></div>
                <div class="display-orb-reason"
                     x-show="displayShowExplanations && displayVotes.right && displayVotes.right !== 'white' && displayReasons.right"
                     x-text="displayReasons.right"></div>
            </div>
        </div>

        <!-- Verdict shown alongside orbs; always in layout to prevent orbs from shifting -->
        <div class="display-verdict-inline" :style="displayPhase !== 'votes' ? 'visibility:hidden' : ''">
            <div class="verdict-stamp"
                 :class="isValidLift() ? 'valid' : 'invalid'"
                 x-text="isValidLift() ? 'Good Lift' : 'No Lift'"></div>
        </div>

        <div class="display-status" x-text="displayStatus"></div>
    </div>

<script type="module" src="/static/js/init.js"></script>
</body>
</html>
