<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Verdict — Powerlifting Judging</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <script type="module" src="/static/js/init.js"></script>
    <script
        defer
        src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"
        integrity="sha384-l8f0VcPi/M1iHPv8egOnY/15TDwqgbOR1anMIJWvU6nLRgZVLTLSaNqi/TOoT5Fh"
        crossorigin="anonymous">
    </script>
</head>
<body x-data="ironVerdictApp()" :class="{ 'display-mode': role === 'display' && screen === 'display' }">

    <!-- Demo Intro Screen -->
    <div class="landing-wrap" x-show="screen === 'demo-intro'">
        <div class="landing-panel cut-corner landing-panel--demo">

            <div class="brand-iron chrome-text">Iron Verdict</div>
            <div class="brand-verdict-sub">Demo Guide</div>

            <p class="demo-guide-text">
                Iron Verdict allows judges to pick the reason for an invalid lift,
                shared instantly with athletes, audience, jury, and fellow judges.
            </p>

            <div class="demo-guide-heading">Why Iron Verdict?</div>
            <ul class="demo-guide-list">
                <li><span class="text-em">Athletes</span> — Know your mistake immediately, no time wasted.</li>
                <li><span class="text-em">Audience</span> — No more guessing why a lift was ruled invalid.</li>
                <li><span class="text-em">Judges</span> — Understand your colleagues' calls and know what to focus on next attempt.</li>
                <li><span class="text-em">Jury</span> — Know exactly which part of the lift to review before overruling.</li>
            </ul>

            <div class="demo-guide-heading">Setup</div>
            <ol class="demo-guide-list">
                <li>Enter a session name → click <span class="text-em">Create New Session</span></li>
                <li>Send the session code to other judges</li>
                <li>Use the session code to set up a <span class="text-em">Display Screen</span></li>
            </ol>

            <div class="demo-guide-heading">Head Judge Controls</div>
            <ul class="demo-guide-list">
                <li><span class="text-em">Show reasons on display</span> — ruling reasons appear on the display screen</li>
                <li><span class="text-em">Require reasons</span> — judges must choose a reason before locking in (optional by default)</li>
                <li><span class="text-em">Lift category dropdown</span> — changes the reason catalogue (Squat / Bench / Deadlift)</li>
            </ul>

            <div class="demo-guide-heading">During Competition</div>
            <ol class="demo-guide-list">
                <li>Head judge announces "The bar is loaded" and presses <span class="text-em">Start Timer</span></li>
                <li>After the lift, judges press their color, optionally pick a reason, then press <span class="text-em">Lock In</span></li>
                <li>When all 3 judges lock in, the result appears on the <span class="text-em">Display Screen</span></li>
                <li>Head judge presses <span class="text-em">Next Lift</span> to reset for the next lifter</li>
                <li>If needed, head judge presses <span class="text-em">Reset Timer</span></li>
                <li>After the event: <span class="text-em">End Session</span> → confirm with <span class="text-em">OK</span></li>
            </ol>

            <div x-show="!demoRunning" class="demo-popup-note">
                This demo opens 4 pop-up windows — please allow pop-ups if prompted.
            </div>

            <div x-show="!demoRunning" class="demo-launch-wrap">
                <button class="btn-blood btn-blood-primary cut-corner-sm" @click="launchDemo()">
                    Launch Demo
                </button>
            </div>

            <div x-show="demoRunning" class="demo-running-msg">
                Demo running — interact with the 4 open windows
            </div>

            <div class="btn-row">
                <button class="btn-blood btn-blood-ghost" @click="returnToLandingFromDemo()">
                    &larr; Back to Start
                </button>
            </div>

        </div>
    </div>

    <!-- Landing Screen -->
    <div class="landing-wrap" x-show="screen === 'landing'">
        <div class="landing-panel cut-corner">
            <div class="brand-iron chrome-text">Iron Verdict</div>
            <div class="brand-verdict-sub">Powerlifting Judging</div>

            <div class="form-stack">
                <input class="chrome-input" placeholder="Session name (e.g. Platform A)"
                       x-model="newSessionName" @keyup.enter="createSession()">
                <button class="btn-blood btn-blood-primary cut-corner-sm"
                        @click="createSession()" :disabled="!newSessionName.trim()">
                    Create New Session
                </button>

                <div class="slash-divider">or</div>

                <input class="chrome-input" placeholder="Enter 8-character session code"
                       x-model="joinCode" @keyup.enter="joinExistingSession()">
                <button class="btn-blood btn-blood-secondary cut-corner-sm"
                        @click="joinExistingSession()" :disabled="!joinCode.trim()">
                    Join Session
                </button>
            </div>

            <div class="btn-row">
                <button class="btn-blood btn-blood-ghost" @click="startDemo()">
                    Start Demo
                </button>
            </div>

            <div class="btn-row--sm">
                <button class="btn-blood btn-blood-ghost" @click="goToContact()">
                    Contact
                </button>
            </div>

            <div class="app-version">
                __APP_VERSION__
            </div>
        </div>
    </div>

    <!-- Contact Screen -->
    <div class="landing-wrap" x-show="screen === 'contact'">
        <div class="landing-panel cut-corner">
            <div class="brand-iron chrome-text">Contact</div>
            <div class="brand-verdict-sub">Iron Verdict</div>

            <form class="form-stack" @submit.prevent="submitContact()" action="https://api.web3forms.com/submit" method="POST">
                <input type="hidden" name="access_key" value="2e92ea27-be19-4996-83c9-0b33fcb63419">
                <input type="checkbox" name="botcheck" style="display:none" tabindex="-1" autocomplete="off">

                <div x-show="contactStatus !== 'success'">
                    <div class="form-stack form-stack--no-top">
                        <input class="chrome-input" type="text" name="name" placeholder="Name"
                               x-model="contactName" required>
                        <input class="chrome-input" type="email" name="email" placeholder="Email (optional)"
                               x-model="contactEmail">
                        <textarea class="chrome-textarea" name="message" placeholder="Message or bug description"
                                  x-model="contactMessage" required></textarea>

                        <button class="btn-blood btn-blood-primary cut-corner-sm"
                                type="submit"
                                :disabled="contactStatus === 'loading' || !contactName.trim() || !contactMessage.trim()"
                                x-text="contactStatus === 'loading' ? 'Sending...' : 'Send Message'">
                        </button>

                        <div x-show="contactStatus === 'error'" class="contact-error">
                            Something went wrong. Please try again.
                        </div>
                    </div>
                </div>

                <div x-show="contactStatus === 'success'" class="contact-success">
                    Message Sent
                    <div class="contact-success-sub">
                        We'll get back to you if you left an email.
                    </div>
                </div>
            </form>

            <div class="btn-row">
                <button class="btn-blood btn-blood-ghost" @click="screen = 'landing'">
                    &larr; Back
                </button>
            </div>
        </div>
    </div>

    <!-- Role Selection Screen -->
    <div class="role-wrap" x-show="screen === 'role-select'">
        <div class="role-panel cut-corner">
            <div class="role-heading chrome-text">Select Role</div>
            <div class="session-tag">
                Session: <span class="code" @click="returnToLanding()" x-text="sessionCode"></span>
            </div>

            <div class="role-grid">
                <button class="role-btn cut-corner-sm" @click="joinSession('left_judge')">
                    Left<br>Judge
                </button>
                <button class="role-btn cut-corner-sm" @click="joinSession('center_judge')">
                    Center<br>Judge<span class="sub">(Head)</span>
                </button>
                <button class="role-btn cut-corner-sm" @click="joinSession('right_judge')">
                    Right<br>Judge
                </button>
                <button class="role-btn role-display-btn cut-corner-sm" @click="joinSession('display')">
                    Display Screen
                </button>
            </div>
        </div>
    </div>

    <!-- Judge Screen -->
    <div class="judge-wrap" x-show="screen === 'judge'">
        <div class="judge-bar">
            <div class="judge-role-label" x-text="getRoleDisplayName()"></div>
            <div class="judge-timer" :class="timerExpired && 'expired'" x-text="timerDisplay"></div>
            <div class="judge-code">
                <span class="conn-dot" :class="connectionStatus"></span>
                <span class="code-link" @click="returnToRoleSelection()" x-text="sessionCode"></span>
            </div>
        </div>

        <div class="vote-grid" x-show="!showingReasonStep" :style="voteLocked ? 'opacity:0.35;pointer-events:none' : ''">
            <button class="vote-btn vote-white cut-corner-sm"
                    :class="selectedVote === 'white' && 'selected'"
                    @click="selectVote('white')" :disabled="voteLocked">
                WHITE
            </button>
            <button class="vote-btn vote-red cut-corner-sm"
                    :class="selectedVote === 'red' && 'selected'"
                    @click="selectVote('red')" :disabled="voteLocked">
                RED
            </button>
            <button class="vote-btn vote-blue cut-corner-sm"
                    :class="selectedVote === 'blue' && 'selected'"
                    @click="selectVote('blue')" :disabled="voteLocked">
                BLUE
            </button>
            <button class="vote-btn vote-yellow cut-corner-sm"
                    :class="selectedVote === 'yellow' && 'selected'"
                    @click="selectVote('yellow')" :disabled="voteLocked">
                YELLOW
            </button>
        </div>

        <div class="reason-step" x-show="showingReasonStep && !voteLocked">
            <div class="reason-step-header">
                <button class="back-btn" @click="goBackToColorStep()">&#8592; back</button>
                <span class="reason-step-color" :class="selectedVote" x-text="selectedVote?.toUpperCase()"></span>
            </div>
            <div class="reason-list">
                <template x-for="reason in getJudgeReasons()" :key="reason">
                    <div class="reason-item"
                         :class="{ selected: selectedReason === reason }"
                         @click="selectReason(reason)"
                         x-text="reason">
                    </div>
                </template>
            </div>
        </div>

        <button class="lock-btn cut-corner-sm"
                x-show="canLockIn() && !voteLocked"
                @click="lockVote()">
            LOCK IN
        </button>

        <div class="locked-status" x-show="voteLocked">
            &#10003; Vote Locked &#8212; <span x-text="selectedVote?.toUpperCase()"></span>
        </div>

        <div class="head-section" x-show="isHead">
            <div class="head-title">Head Judge Controls</div>
            <div class="head-grid">
                <button class="btn-blood btn-blood-primary cut-corner-sm"
                        @click="startTimer()">Start Timer</button>
                <button class="btn-blood btn-blood-secondary cut-corner-sm"
                        @click="resetTimer()">Reset Timer</button>
                <button class="btn-blood btn-blood-primary cut-corner-sm"
                        @click="nextLift()" :disabled="!resultsShown">Next Lift</button>
                <button class="btn-blood btn-blood-ghost"
                        @click="confirmEndSession()">End Session</button>
            </div>
            <div class="settings-bar">
                <label>
                    <input type="checkbox" x-model="showExplanations" @change="saveSettings()">
                    Show reasons on display
                </label>
                <label>
                    <input type="checkbox" x-model="requireReasons" @change="saveSettings()">
                    Require reasons
                </label>
                <select x-model="liftType" @change="saveSettings()">
                    <option value="squat">Squat</option>
                    <option value="bench">Bench Press</option>
                    <option value="deadlift">Deadlift</option>
                </select>
            </div>
        </div>

        <!-- Judge Results Panel -->
        <div class="head-section" x-show="resultsShown">
            <div class="head-title">Results</div>
            <div class="judge-results-orbs">
                <div class="judge-result-orb-wrap">
                    <div class="display-orb display-orb--sm" :class="judgeResultVotes.left"></div>
                    <div class="display-orb-reason"
                         x-show="judgeResultReasons.left"
                         x-text="judgeResultReasons.left"></div>
                </div>
                <div class="judge-result-orb-wrap">
                    <div class="display-orb display-orb--sm" :class="judgeResultVotes.center"></div>
                    <div class="display-orb-reason"
                         x-show="judgeResultReasons.center"
                         x-text="judgeResultReasons.center"></div>
                </div>
                <div class="judge-result-orb-wrap">
                    <div class="display-orb display-orb--sm" :class="judgeResultVotes.right"></div>
                    <div class="display-orb-reason"
                         x-show="judgeResultReasons.right"
                         x-text="judgeResultReasons.right"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Display Screen: shows sessionName only — sessionCode intentionally omitted (C3) -->
    <div class="display-full" x-show="screen === 'display'">
        <div class="display-tag">
            <span class="conn-dot" :class="connectionStatus"></span>
            <span x-show="!isDemo" x-text="sessionName"></span>
            <span x-show="isDemo">DEMO</span>
        </div>

        <div class="display-timer-big" :class="timerExpired && 'expired'" x-text="timerDisplay"></div>

        <!-- Vote orbs with reasons -->
        <div class="display-lights" x-show="displayPhase === 'votes' || displayPhase === 'idle'">
            <div class="display-orb-wrap">
                <div class="display-orb" :class="displayVotes.left"></div>
                <div class="display-orb-reason"
                     x-show="displayShowExplanations && displayVotes.left && displayVotes.left !== 'white' && displayReasons.left"
                     x-text="displayReasons.left"></div>
            </div>
            <div class="display-orb-wrap">
                <div class="display-orb" :class="displayVotes.center"></div>
                <div class="display-orb-reason"
                     x-show="displayShowExplanations && displayVotes.center && displayVotes.center !== 'white' && displayReasons.center"
                     x-text="displayReasons.center"></div>
            </div>
            <div class="display-orb-wrap">
                <div class="display-orb" :class="displayVotes.right"></div>
                <div class="display-orb-reason"
                     x-show="displayShowExplanations && displayVotes.right && displayVotes.right !== 'white' && displayReasons.right"
                     x-text="displayReasons.right"></div>
            </div>
        </div>

        <!-- Verdict shown alongside orbs; always in layout to prevent orbs from shifting -->
        <div class="display-verdict-inline" :style="displayPhase !== 'votes' ? 'visibility:hidden' : ''">
            <div class="verdict-stamp"
                 :class="isValidLift() ? 'valid' : 'invalid'"
                 x-text="isValidLift() ? 'Good Lift' : 'No Lift'"></div>
        </div>

        <div class="display-status" x-text="displayStatus"></div>
    </div>

</body>
</html>
